---
applyTo: '**/*.{js,jsx,ts,tsx}'
description: 'Custom coding instructions for The Poradas Wedding Site'
---

# The Poradas Wedding Site - Development Instructions

## Project Context

This is a post-wedding website for Austin & Jordyn's wedding that allows guests to:

- View a film-length wedding video (YouTube embedded)
- Browse and upload photos/videos in a shared album
- View an interactive world map showing guest locations

**Tech Stack:**

- **Frontend**: Next.js 15.5.4 (Pages Router), React 19.1.1
- **Language**: TypeScript (strict mode) + JavaScript
- **Styling**: Tailwind CSS with custom wedding theme
- **Backend**: Firebase Cloud Functions (Gen 2), Firestore, Cloud Storage
- **Testing**: Playwright E2E tests (90 tests across 5 browsers)
- **Build Tools**: Jest, ESLint (flat config), TypeScript compiler

## Coding Standards

### TypeScript

- Use TypeScript for all new files (.ts, .tsx)
- Enable strict mode (already configured)
- Use `import type { ... }` for type-only imports
- Define explicit return types for public APIs
- Avoid `any` - use `unknown` when type is truly unknown
- Use optional chaining (`?.`) and nullish coalescing (`??`)

### React Components

- **Functional components only** with hooks
- Use arrow functions: `export default function ComponentName() {}`
- Prefer composition over inheritance
- Use React 19 Actions API for server-like patterns
- Use `useTransition` for pending states (already in map.js)
- Lazy load heavy components (PhotoUpload, VideoPlayer, Leaflet)

### Styling with Tailwind CSS

- **Use Tailwind utility classes only** - no inline styles
- **Wedding theme colors** (defined in tailwind.config.js):
  - `sage`: #9ca986 (primary green)
  - `blush`: #d8a7b1 (soft pink)
  - `mint`: #c5e1c7 (light green)
  - `cream`: #f5f1e6 (off-white background)
- **Typography**:
  - `font-display`: Playfair Display (headings, titles)
  - `font-body`: Lora (body text, paragraphs)
- Use `next/font` for optimized font loading (already configured)
- Responsive design: mobile-first with `sm:`, `md:`, `lg:`, `xl:` breakpoints

### Firebase Integration

- Use Firebase v12.3.0 (already installed)
- **Firestore**: Document database for user data, pins, metadata
- **Cloud Storage**: Store uploaded photos/videos
- **Cloud Functions**: Gen 2 functions only (Gen 1 deprecated)
  - Use `onRequest`, `onCall`, `onDocumentWritten` from `firebase-functions/v2`
- Initialize Firebase in `firebaseClient.js` (already configured)
- Use `getFirestore`, `getStorage`, `getAuth` from modular SDK

### Testing with Playwright

- **Test structure**: `tests/e2e/*.spec.js`
- **Browsers**: Chromium, Firefox, WebKit, Mobile Chrome, Mobile Safari
- **Selectors**:
  - Prefer `data-testid` attributes for stable selectors
  - Use `.first()` when multiple elements match (strict mode)
- **Assertions**: Use `expect(locator).toBeVisible()`, `.toHaveText()`, etc.
- **Run tests**: `npx playwright test` (90 tests total)
- Add tests for new features - maintain 90%+ coverage

### Performance Targets

- **Lighthouse Score**: >95
- **Largest Contentful Paint (LCP)**: <1.5s
- **Cumulative Layout Shift (CLS)**: <0.1
- **First Input Delay (FID)**: <100ms

### Optimization Techniques

- Use `next/image` for all images (not `<img>` tags)
- Lazy load heavy components with `dynamic(() => import(...))`
- Use `loading="lazy"` for native lazy loading
- Code splitting with dynamic imports
- Minimize bundle size - check with `npm run build`

## Project Structure

```
theporadas_site/
├── site/                   # Next.js application (Pages Router)
│   ├── pages/             # Routes: index.js, map.js, gallery.js
│   ├── components/        # React components: Button, TimelineCard, etc.
│   ├── styles/            # Global CSS, Tailwind config
│   └── public/            # Static assets
├── functions/             # Firebase Cloud Functions (Gen 2)
│   ├── index.js           # Main functions file
│   ├── generateThumbnail/ # Thumbnail generation function
│   └── ping/              # Health check endpoint
├── tests/e2e/             # Playwright E2E tests
├── docs/                  # Project documentation
├── firebase.json          # Firebase configuration
├── firestore.rules        # Firestore security rules
├── storage.rules          # Cloud Storage security rules
├── package.json           # Root package.json (workspaces)
└── mcp-config.json        # MCP server configuration
```

## Common Tasks

### Add a New Page

1. Create file in `site/pages/`: `new-page.js`
2. Add navigation link in `site/pages/index.js` (nav element)
3. Use Next.js `Link` component: `<Link href="/new-page">Label</Link>`
4. Add Playwright tests in `tests/e2e/new-page.spec.js`

### Add a New Component

1. Create file in `site/components/`: `NewComponent.jsx`
2. Use functional component with hooks
3. Define TypeScript interface for props (if using .tsx)
4. Export as default: `export default function NewComponent() {}`
5. Import in parent: `import NewComponent from '../components/NewComponent'`

### Update Firebase Functions

1. Modify `functions/index.js` or create new file in `functions/`
2. Use Gen 2 APIs: `import { onRequest } from 'firebase-functions/v2/https'`
3. Test locally: `firebase emulators:start`
4. Deploy: `firebase deploy --only functions`

### Fix Test Failures

1. Run tests: `npx playwright test`
2. Check test expectations in `tests/e2e/*.spec.js`
3. Update component to match test expectations
4. Re-run tests to verify fix
5. Check for regressions in other tests

## Code Review Checklist

Before committing code, ensure:

- [ ] TypeScript types defined (no `any` types)
- [ ] ESLint warnings addressed (`npm run lint`)
- [ ] Tailwind classes used (no inline styles)
- [ ] Components are accessible (ARIA labels, keyboard navigation)
- [ ] Images use `next/image` (not `<img>` tags)
- [ ] No `console.log` in production code
- [ ] Tests pass (`npx playwright test`)
- [ ] No security vulnerabilities (`npm audit`)

## Performance Guidelines

### Code Splitting

- Lazy load heavy components:
  ```javascript
  const PhotoUpload = dynamic(() => import('../components/PhotoUpload'), {
    loading: () => <p>Loading...</p>,
  });
  ```

### Image Optimization

- Use `next/image` with priority for above-the-fold images:
  ```javascript
  <Image src="/hero.jpg" alt="Wedding hero" width={1920} height={1080} priority />
  ```

### Bundle Size

- Check bundle size: `npm run build`
- Target: <500KB total JavaScript
- Use tree-shaking (ESM imports only)

## Security Best Practices

- Never commit API keys or secrets to Git
- Use environment variables (`.env.local`)
- Validate all user inputs (Firebase Security Rules)
- Sanitize file uploads (check file types, sizes)
- Use HTTPS for all external requests
- Keep dependencies updated (`npm outdated`)

## Deployment

### Vercel/Firebase Hosting

- Next.js app: `npm run build && npm run start`
- Firebase Functions: `firebase deploy --only functions`
- Database rules: `firebase deploy --only firestore:rules`
- Storage rules: `firebase deploy --only storage:rules`

## Debugging

### VS Code Debugging

- Use VS Code debugger for Node.js and browser
- Set breakpoints in `.js`, `.jsx`, `.ts`, `.tsx` files
- Use `debugger;` statement for quick breakpoints

### Playwright Debugging

- Run in debug mode: `npx playwright test --debug`
- Use `page.pause()` to pause execution
- Check screenshots in `test-results/` directory

## Additional Resources

- [Next.js Docs](https://nextjs.org/docs)
- [React Docs](https://react.dev)
- [Tailwind CSS Docs](https://tailwindcss.com/docs)
- [Firebase Docs](https://firebase.google.com/docs)
- [Playwright Docs](https://playwright.dev)
