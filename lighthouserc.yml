# Lighthouse CI Configuration
# Automated performance monitoring for every deployment
# Documentation: https://github.com/GoogleChrome/lighthouse-ci

ci:
  collect:
    # Pages to test
    url:
      - http://localhost:3000
      - http://localhost:3000/#gallery
      - http://localhost:3000/#upload
    
    # Number of runs per URL (median of 3)
    numberOfRuns: 3
    
    # Lighthouse settings
    settings:
      preset: 'desktop'
      # Emulated device
      formFactor: 'desktop'
      # Disable throttling for realistic results
      throttling:
        rttMs: 40
        throughputKbps: 10240
        cpuSlowdownMultiplier: 1
      # Skip PWA audit (we have custom PWA setup)
      skipAudits:
        - 'uses-http2'
        - 'redirects-http'
    
    # Start dev server automatically
    startServerCommand: 'cd site && npm run dev'
    startServerReadyPattern: 'Ready'
    startServerReadyTimeout: 60000
  
  assert:
    # Performance budgets
    assertions:
      # Core Web Vitals
      'first-contentful-paint': ['error', { maxNumericValue: 1800 }]
      'largest-contentful-paint': ['error', { maxNumericValue: 2500 }]
      'cumulative-layout-shift': ['error', { maxNumericValue: 0.1 }]
      'total-blocking-time': ['warn', { maxNumericValue: 300 }]
      'speed-index': ['warn', { maxNumericValue: 3400 }]
      
      # Category scores (0-100)
      'categories:performance': ['error', { minScore: 0.9 }]
      'categories:accessibility': ['error', { minScore: 0.95 }]
      'categories:best-practices': ['error', { minScore: 0.9 }]
      'categories:seo': ['error', { minScore: 0.95 }]
      
      # Specific audits
      'uses-responsive-images': 'warn'
      'offscreen-images': 'warn'
      'uses-optimized-images': 'warn'
      'modern-image-formats': 'warn'
      'uses-text-compression': 'error'
      'uses-rel-preconnect': 'warn'
      'font-display': 'warn'
      'unminified-css': 'error'
      'unminified-javascript': 'error'
      'unused-css-rules': 'warn'
      'unused-javascript': 'warn'
      'efficient-animated-content': 'warn'
      'duplicated-javascript': 'warn'
      'legacy-javascript': 'warn'
      
      # Accessibility
      'color-contrast': 'error'
      'image-alt': 'error'
      'label': 'error'
      'link-name': 'error'
      'button-name': 'error'
      'document-title': 'error'
      'html-has-lang': 'error'
      
      # Best Practices
      'errors-in-console': 'error'
      'no-vulnerable-libraries': 'error'
      'uses-https': 'error'
      
      # SEO
      'meta-description': 'error'
      'http-status-code': 'error'
      'link-text': 'error'
      'crawlable-anchors': 'error'
      'robots-txt': 'error'
      'canonical': 'warn'
  
  upload:
    # Upload results to temporary public storage
    target: 'temporary-public-storage'
    
    # Or upload to Lighthouse CI server (if self-hosted)
    # target: 'lhci'
    # serverBaseUrl: 'https://your-lhci-server.com'
    # token: 'your-build-token'
  
  server:
    # Optional: Self-hosted LHCI server settings
    # port: 9001
    # storage:
    #   storageMethod: 'sql'
    #   sqlDialect: 'postgres'
    #   sqlConnectionUrl: 'postgresql://user:password@localhost/lighthouse-ci'
